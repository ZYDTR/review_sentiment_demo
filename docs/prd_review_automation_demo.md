# PRD：客户评论自动化 Demo（V1）

- 文档状态：Draft
- 最后更新：2026-02-19
- 负责人：项目组
- 关联文档：
  - `docs/rfc_review_automation_v1.md`
  - `docs/api_facts_google_sheet_make_llm.md`
  - `docs/working_log.md`
  - `docs/lessons_playbook.md`

## 1. 产品定位
本项目目标是交付一个可演示、可维护、可扩展的自动化流程：从 Google Sheets 中读取客户评论，完成情感分类与摘要，回写结果，并每周自动发送汇总邮件。

该 Demo 必须体现“可上线思维”，不是一次性玩具脚本。

## 2. 非目标（V1 不做）
1. 多语言情感分类。
2. 复杂 BI 看板系统。
3. 模型训练与完整 MLOps。
4. 企业级权限与审计系统。

## 3. 目标用户与使用场景
### 目标用户
1. 运营负责人：每周查看评论趋势和风险信号。
2. 维护同学：调整 prompt、字段映射和邮件模板。

### 核心场景
1. Google Sheet 新增一条评论。
2. 系统自动识别情感并生成一句话摘要。
3. 结果回写到同一行新列。
4. 每周自动汇总统计并发送 HTML 邮件。
5. 维护者无需改代码即可调整 prompt 或列名映射。

## 4. 目标与验收标准
### 目标
1. 打通“新增评论 -> AI处理 -> 回写 -> 周报邮件”完整闭环。
2. 输出格式稳定，人工返工少。
3. 交接清晰，可由非原作者维护。

### 验收标准（Demo 可交付）
1. 功能完整性：
   - 新增行可自动处理。
   - 情感和摘要稳定写入指定列。
   - 每周汇总邮件可自动发送。
2. 输出质量：
   - `sentiment` 仅允许 `Positive | Neutral | Negative`。
   - `summary` 为非空单句。
   - 在 30 条人工标注样本上，情感准确率 >= 80%。
3. 可靠性：
   - 存在可执行重试路径。
   - 失败行有可定位的错误状态。
   - 已处理成功行支持幂等跳过。
4. 可维护性：
   - prompt 与列映射可配置。
   - 新维护者 30 分钟内可完成基础操作。

## 5. 范围定义
### Must Have
1. 连接已有 Google Sheet 评论表。
2. 触发并处理新增评论行。
3. 生成并回写：
   - 情感标签（`Positive | Neutral | Negative`）
   - 一句话摘要
4. 每周汇总：
   - 评论总数
   - 三类情感计数
   - 一句总体趋势总结
5. 自动发送整洁 HTML 邮件。
6. 具备基础运维能力：
   - 重试策略
   - 错误可见性
   - prompt 可配置

### Should Have
1. 每行记录模型版本与 prompt 版本。
2. 增加简单主题标签（为后续扩展预留）。
3. 邮件中包含负面评论重点主题。

### Could Have
1. 同步发送 Slack 通知。
2. 轻量趋势可视化页面。

## 6. 行为规则
1. 输入规则：
   - `review_text` 必须存在且非空。
   - 空评论标记为 `SKIPPED_EMPTY_INPUT`。
2. 输出列规范：
   - `sentiment`
   - `summary`
   - `processed_at`
   - `run_id`
   - `model_version`
   - `prompt_version`
   - `status`
   - `error_reason`
3. 幂等规则：
   - 若 `status=SUCCESS` 且存在 `run_id`，默认不重复处理（除非强制重跑）。
4. 输出格式规则：
   - 情感值必须为严格枚举。
   - 摘要目标长度 <= 30 词。
5. 周报时间窗：
   - 默认按配置时区的周一 00:00 至周日 23:59。

## 7. 风险与约束
1. LLM 输出波动：
   - 方案：严格 schema + 结果校验 + 一次纠错重试。
2. 外部 API 超时或限流：
   - 方案：指数退避、有限重试、失败标记。
3. 表结构漂移：
   - 方案：流程启动前做列检查，缺列直接报错。
4. prompt 版本退化：
   - 方案：版本留痕 + 样本回归检查。

## 8. 里程碑
1. 完成 PRD/RFC/API Facts 文档。
2. 跑通端到端 Demo。
3. 完成幂等、错误处理和可维护性加固。
4. 交付演示脚本与交接说明。

## 9. 面试演示脚本
1. 在源表新增 3 条评论。
2. 触发流程并展示逐行回写结果。
3. 演示 1 条失败样例及重试恢复。
4. 触发周报并展示 HTML 邮件。
5. 展示 prompt 与字段映射如何配置修改。
6. 展示执行日志与决策记录，证明可维护性。
